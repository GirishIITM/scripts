#!/bin/bash
# one command to set, increase, decrease, mute, and
# display sink volume

## usage:
## vol           -> displays the current volume
## vol up/down   -> increase/decrease volume by 5%
## vol 52%       -> set the volume to 52%
## vol +17%      -> increase the volume by 17%
## vol -14%      -> decrease the volume by 14%
## vol mute      -> toggle volume mute (turns mute on/off)
cmd="volume"
step="5"
if [[ -n "$1" ]]
then
	case $1 in
		up) val="+${step}%";;
		down) val="-${step}%";;
		mute) cmd="mute"; val="toggle";;
		bar) val="+0%" ;;
		*) val=$1;;
	esac
	pactl -- set-sink-"$cmd" "@DEFAULT_SINK@" "$val"
fi
# display volume
ps=$(amixer get Master | tail -n1)
vol=$(pactl -- get-sink-volume "@DEFAULT_SINK@" | grep -oP '\d*%' | uniq)
vol=${vol//%/}
mute=$(echo "$ps" | grep -Po ".*\[\K\w*")
volume_symbol=(" " "_" "▁" "▂" "▃" "▄" "▅" "▆" "▇" "█" )
# print volume symbol according to percentage
if [[ "$1" == "bar" ]]; then
  index=${vol:0:-1}
  if [[ "$index" -ge 10 ]]; then index=9; fi
  output="${volume_symbol[$index]}"
  if [[ "$vol" -gt 100 ]]; then output="${output}⁺" ; fi
else
  output="${vol}%"
fi
case $mute in
	on) echo " $output";;
	*)  echo "🔇";;
esac
